import { createContext, useContext, useState, useEffect, type ReactNode } from "react";

export type Language = "en" | "ru" | "he";

export const LANGUAGES: { code: Language; label: string; nativeLabel: string; dir: "ltr" | "rtl" }[] = [
  { code: "en", label: "English", nativeLabel: "English", dir: "ltr" },
  { code: "ru", label: "Russian", nativeLabel: "Русский", dir: "ltr" },
  { code: "he", label: "Hebrew", nativeLabel: "עברית", dir: "rtl" },
];

const translations: Record<Language, Record<string, string>> = {
  en: {
    "nav.recipeView": "Recipe View",
    "nav.weeklyMeals": "Weekly Meals",
    "nav.importRecipe": "Import Recipe",
    "nav.groceryList": "Grocery List",

    "recipe.backToSelection": "← Back to selection",
    "recipe.addToMyPicks": "Add to My Picks",
    "recipe.removeFromMyPicks": "Remove from My Picks",
    "recipe.howDidThisTurnOut": "How did this turn out?",
    "recipe.source": "Source: Personal • Modified by you",
    "recipe.nutrition": "Per serving (approx.): 320 kcal · P 28g · F 12g · C 24g",
    "recipe.servings": "Servings",
    "recipe.guidance": "Guidance",
    "recipe.focus": "Focus",
    "recipe.notes": "Notes",
    "recipe.result": "Result",
    "recipe.cup": "Cup",
    "recipe.stepOf": "Step {current} of {total}",
    "recipe.completed": "✓ Completed",
    "recipe.done": "Done!",
    "recipe.cookAgain": "Cook again from start",
    "recipe.timer": "Timer ({time})",
    "recipe.stop": "Stop",
    "recipe.startTimer": "Start {min} min timer",
    "recipe.showHint": "Show hint",
    "recipe.hint": "Hint:",
    "recipe.markDone": "Mark done →",
    "recipe.finishCooking": "Finish cooking ✓",
    "recipe.nextStep": "Next step →",
    "recipe.ingredientsReady": "Ingredients ready ✓",
    "recipe.myNotes": "My notes",
    "recipe.myResult": "My result",
    "recipe.removePhoto": "Remove photo",
    "recipe.openRecipe": "Open recipe",
    "recipe.plov": "Plov",

    "meals.tablewise": "Tablewise",
    "meals.weeklyPlan": "Weekly Plan",
    "meals.calmPlanning": "Calm weekly planning",
    "meals.howItWorks": "How it works",
    "meals.plan": "Plan",
    "meals.cost": "Cost",
    "meals.logIn": "Log in",
    "meals.backToSelection": "← Back to selection",
    "meals.clearWeek": "Clear Week",
    "meals.weekLocked": "Week Locked",
    "meals.unlock": "Unlock",
    "meals.finalizeWeek": "Finalize Week",
    "meals.createGroceryList": "Create Grocery List",
    "meals.selectedRecipes": "Selected Recipes",
    "meals.weekIsLocked": "Week is locked",
    "meals.dragToCalendar": "Drag to the calendar",
    "meals.myPicks": "My Picks",
    "meals.allRecipes": "All Recipes",
    "meals.allOnPlan": "All selected recipes are on your plan.",
    "meals.selectedThisWeek": "Selected this week",
    "meals.weeklyPlanTitle": "Weekly Plan",
    "meals.lockedUnlockToEdit": "Locked - Unlock to edit",
    "meals.weekFinalized": "Your week is finalized. Unlock to make changes.",
    "meals.dragToSlots": "Drag meals to slots. Use +/− to extend across days.",
    "meals.dropHere": "Drop here",
    "meals.locked": "Locked",
    "meals.days": "{count} days",
    "meals.step2Title": "Step 2 — Meals",
    "meals.step2Desc": "Choose dinners with calm filters. Select 6–12 options. We'll build a week from there.",
    "meals.selected": "Selected: {count} / 12",
    "meals.max12": "Max 12 selections.",
    "meals.noRecipesMatch": "No recipes match your current filters.",
    "meals.add": "Add",
    "meals.added": "Added",
    "meals.generateWeeklyPlan": "Generate weekly plan",
    "meals.select6": "Select at least 6 recipes to generate a plan.",
    "meals.filters": "Filters ({count})",
    "meals.clearAll": "Clear all",
    "meals.maxMinutes": "Max minutes",
    "meals.dietary": "Dietary",
    "meals.vegetarian": "Vegetarian",
    "meals.kidFriendly": "Kid friendly",
    "meals.glutenFree": "Gluten-free",
    "meals.mealType": "Meal type",
    "meals.breakfast": "Breakfast",
    "meals.lunch": "Lunch",
    "meals.dinner": "Dinner",
    "meals.lunchBox": "Lunch box",
    "meals.cookingMethod": "Cooking method",
    "meals.oven": "Oven",
    "meals.airFryer": "Air fryer",
    "meals.stovetop": "Stovetop",
    "meals.noCook": "No-cook",
    "meals.source": "Source",
    "meals.myRecipes": "My recipes",
    "meals.imported": "Imported",
    "meals.trustedAuthors": "Trusted authors",
    "meals.personal": "Personal",
    "meals.lessFilters": "− Less filters",
    "meals.moreFilters": "+ More filters",
    "meals.proteinType": "Protein type",
    "meals.chicken": "Chicken",
    "meals.beef": "Beef",
    "meals.seafood": "Seafood",
    "meals.plantBased": "Plant-based",
    "meals.myPicksFilter": "My Picks ⭐",
    "meals.showOnlyMyPicks": "Show only My Picks",
    "meals.minimumRating": "Minimum Rating",
    "meals.any": "Any",
    "meals.withMyNotes": "With my notes",
    "meals.modifiedByMe": "Modified by me",
    "meals.mustInclude": "Must include",
    "meals.mustExclude": "Must exclude",
    "meals.typeEnter": "Type + Enter",
    "meals.servingsFilter": "Servings",
    "meals.min": "{count} min",

    "meals.sun": "Sun",
    "meals.mon": "Mon",
    "meals.tue": "Tue",
    "meals.wed": "Wed",
    "meals.thu": "Thu",
    "meals.fri": "Fri",
    "meals.sat": "Sat",

    "import.label": "Import",
    "import.title": "Bring your recipe",
    "import.subtitle": "Paste a title, ingredient lines, and steps. Stored locally in your browser.",
    "import.photo": "Photo (optional)",
    "import.takePhoto": "Take a photo or upload",
    "import.sourceLink": "Source link (optional)",
    "import.sourcePlaceholder": "Paste recipe link (Instagram, website, YouTube)",
    "import.invalidUrl": "Please enter a valid URL (e.g., https://...)",
    "import.voiceAi": "Voice (AI)",
    "import.speakRecipe": "Speak your recipe",
    "import.voiceDesc": "Say the recipe out loud — AI will structure it into a proper recipe with title, ingredients, and steps.",
    "import.voiceNotSupported": "Voice transcription isn't supported in this browser.",
    "import.startDictation": "Start dictation",
    "import.stopDictation": "Stop",
    "import.aiThinking": "AI is thinking…",
    "import.generateWithAi": "Generate recipe with AI",
    "import.tipDescribe": "Tip: Describe your recipe naturally — AI will organize it for you.",
    "import.listening": "Listening…",
    "import.transcriptReady": "Transcript ready — click 'Generate recipe with AI' to structure it.",
    "import.sendingToAi": "Sending to AI for structuring…",
    "import.clear": "Clear",
    "import.titleLabel": "Title",
    "import.titlePlaceholder": "e.g., Quinoa bowls with veggies",
    "import.titleHint": "A title helps you find this recipe later",
    "import.ingredientsLabel": "Ingredients (one per line)",
    "import.stepsLabel": "Steps (one per line)",
    "import.saveAndOpen": "Save & open",
    "import.back": "Back",
    "import.howItWorks": "How it works",
    "import.howIt1": "Speak your recipe naturally — AI will structure it with a proper title, ingredients with quantities, and step-by-step instructions",
    "import.howIt2": "Or type everything manually in the fields below",
    "import.howIt3": "Add a photo and source link (both optional)",
    "import.howIt4": "Your recipe is stored locally in your browser",
    "import.replaceConfirm": "Replace existing content with AI-generated recipe?",
    "import.error": "Something went wrong. Try again.",
    "import.recipePreview": "Recipe preview",

    "grocery.title": "Your Grocery List",
    "grocery.groceryList": "Grocery List",
    "grocery.items": "{total} items from {recipes} recipes",
    "grocery.checked": "{checked} of {total} items checked",
    "grocery.uncheckAll": "Uncheck all",
    "grocery.backToPlan": "← Back to Weekly Plan",
    "grocery.noMeals": "No meals planned yet",
    "grocery.goToPlan": "Go to Weekly Plan",
    "grocery.produce": "Produce",
    "grocery.meatPoultry": "Meat & Poultry",
    "grocery.seafood": "Seafood",
    "grocery.dairyEggs": "Dairy & Eggs",
    "grocery.grainsPasta": "Grains & Pasta",
    "grocery.cannedJarred": "Canned & Jarred",
    "grocery.spicesSeasonings": "Spices & Seasonings",
    "grocery.other": "Other",

    "notFound.title": "404 Page Not Found",
    "notFound.message": "Did you forget to add the page to the router?",
  },

  ru: {
    "nav.recipeView": "Рецепт",
    "nav.weeklyMeals": "Меню недели",
    "nav.importRecipe": "Импорт рецепта",
    "nav.groceryList": "Список покупок",

    "recipe.backToSelection": "← Назад к выбору",
    "recipe.addToMyPicks": "Добавить в Избранное",
    "recipe.removeFromMyPicks": "Убрать из Избранного",
    "recipe.howDidThisTurnOut": "Как получилось?",
    "recipe.source": "Источник: Личный • Изменён вами",
    "recipe.nutrition": "На порцию (прибл.): 320 ккал · Б 28г · Ж 12г · У 24г",
    "recipe.servings": "Порции",
    "recipe.guidance": "Подсказки",
    "recipe.focus": "Фокус",
    "recipe.notes": "Заметки",
    "recipe.result": "Результат",
    "recipe.cup": "Чашка",
    "recipe.stepOf": "Шаг {current} из {total}",
    "recipe.completed": "✓ Выполнено",
    "recipe.done": "Готово!",
    "recipe.cookAgain": "Приготовить снова",
    "recipe.timer": "Таймер ({time})",
    "recipe.stop": "Стоп",
    "recipe.startTimer": "Запустить таймер на {min} мин",
    "recipe.showHint": "Показать подсказку",
    "recipe.hint": "Подсказка:",
    "recipe.markDone": "Отметить →",
    "recipe.finishCooking": "Завершить готовку ✓",
    "recipe.nextStep": "Следующий шаг →",
    "recipe.ingredientsReady": "Ингредиенты готовы ✓",
    "recipe.myNotes": "Мои заметки",
    "recipe.myResult": "Мой результат",
    "recipe.removePhoto": "Удалить фото",
    "recipe.openRecipe": "Открыть рецепт",
    "recipe.plov": "Плов",

    "meals.tablewise": "Tablewise",
    "meals.weeklyPlan": "Недельный план",
    "meals.calmPlanning": "Спокойное планирование недели",
    "meals.howItWorks": "Как это работает",
    "meals.plan": "План",
    "meals.cost": "Стоимость",
    "meals.logIn": "Войти",
    "meals.backToSelection": "← Назад к выбору",
    "meals.clearWeek": "Очистить неделю",
    "meals.weekLocked": "Неделя закреплена",
    "meals.unlock": "Разблокировать",
    "meals.finalizeWeek": "Завершить неделю",
    "meals.createGroceryList": "Создать список покупок",
    "meals.selectedRecipes": "Выбранные рецепты",
    "meals.weekIsLocked": "Неделя закреплена",
    "meals.dragToCalendar": "Перетащите в календарь",
    "meals.myPicks": "Избранное",
    "meals.allRecipes": "Все рецепты",
    "meals.allOnPlan": "Все выбранные рецепты в плане.",
    "meals.selectedThisWeek": "Выбрано на этой неделе",
    "meals.weeklyPlanTitle": "Недельный план",
    "meals.lockedUnlockToEdit": "Закреплено — Разблокируйте для редактирования",
    "meals.weekFinalized": "Неделя завершена. Разблокируйте для изменений.",
    "meals.dragToSlots": "Перетащите блюда в ячейки. Используйте +/− для расширения.",
    "meals.dropHere": "Сюда",
    "meals.locked": "Закреплено",
    "meals.days": "{count} дн.",
    "meals.step2Title": "Шаг 2 — Блюда",
    "meals.step2Desc": "Выберите ужины с фильтрами. Выберите 6–12 вариантов. Мы составим неделю.",
    "meals.selected": "Выбрано: {count} / 12",
    "meals.max12": "Максимум 12 вариантов.",
    "meals.noRecipesMatch": "Нет рецептов по вашим фильтрам.",
    "meals.add": "Добавить",
    "meals.added": "Добавлено",
    "meals.generateWeeklyPlan": "Составить план",
    "meals.select6": "Выберите минимум 6 рецептов для плана.",
    "meals.filters": "Фильтры ({count})",
    "meals.clearAll": "Очистить все",
    "meals.maxMinutes": "Макс. минут",
    "meals.dietary": "Диета",
    "meals.vegetarian": "Вегетарианское",
    "meals.kidFriendly": "Для детей",
    "meals.glutenFree": "Без глютена",
    "meals.mealType": "Приём пищи",
    "meals.breakfast": "Завтрак",
    "meals.lunch": "Обед",
    "meals.dinner": "Ужин",
    "meals.lunchBox": "Ланч-бокс",
    "meals.cookingMethod": "Способ готовки",
    "meals.oven": "Духовка",
    "meals.airFryer": "Аэрогриль",
    "meals.stovetop": "Плита",
    "meals.noCook": "Без готовки",
    "meals.source": "Источник",
    "meals.myRecipes": "Мои рецепты",
    "meals.imported": "Импортированные",
    "meals.trustedAuthors": "Проверенные авторы",
    "meals.personal": "Личные",
    "meals.lessFilters": "− Меньше фильтров",
    "meals.moreFilters": "+ Больше фильтров",
    "meals.proteinType": "Тип белка",
    "meals.chicken": "Курица",
    "meals.beef": "Говядина",
    "meals.seafood": "Морепродукты",
    "meals.plantBased": "Растительный",
    "meals.myPicksFilter": "Избранное ⭐",
    "meals.showOnlyMyPicks": "Только Избранное",
    "meals.minimumRating": "Мин. оценка",
    "meals.any": "Любой",
    "meals.withMyNotes": "С моими заметками",
    "meals.modifiedByMe": "Изменённые мной",
    "meals.mustInclude": "Должно включать",
    "meals.mustExclude": "Не должно включать",
    "meals.typeEnter": "Введите + Enter",
    "meals.servingsFilter": "Порции",
    "meals.min": "{count} мин",

    "meals.sun": "Вс",
    "meals.mon": "Пн",
    "meals.tue": "Вт",
    "meals.wed": "Ср",
    "meals.thu": "Чт",
    "meals.fri": "Пт",
    "meals.sat": "Сб",

    "import.label": "Импорт",
    "import.title": "Добавьте свой рецепт",
    "import.subtitle": "Введите название, ингредиенты и шаги. Хранится локально в браузере.",
    "import.photo": "Фото (необязательно)",
    "import.takePhoto": "Сделать фото или загрузить",
    "import.sourceLink": "Ссылка на источник (необязательно)",
    "import.sourcePlaceholder": "Вставьте ссылку (Instagram, сайт, YouTube)",
    "import.invalidUrl": "Введите корректный URL (например, https://...)",
    "import.voiceAi": "Голос (ИИ)",
    "import.speakRecipe": "Расскажите рецепт",
    "import.voiceDesc": "Произнесите рецепт — ИИ структурирует его: название, ингредиенты и шаги.",
    "import.voiceNotSupported": "Голосовой ввод не поддерживается в этом браузере.",
    "import.startDictation": "Начать запись",
    "import.stopDictation": "Остановить",
    "import.aiThinking": "ИИ думает…",
    "import.generateWithAi": "Создать рецепт с ИИ",
    "import.tipDescribe": "Совет: Опишите рецепт своими словами — ИИ организует его.",
    "import.listening": "Слушаю…",
    "import.transcriptReady": "Текст готов — нажмите «Создать рецепт с ИИ».",
    "import.sendingToAi": "Отправка в ИИ…",
    "import.clear": "Очистить",
    "import.titleLabel": "Название",
    "import.titlePlaceholder": "напр., Боулы с киноа и овощами",
    "import.titleHint": "Название поможет найти рецепт позже",
    "import.ingredientsLabel": "Ингредиенты (по одному на строку)",
    "import.stepsLabel": "Шаги (по одному на строку)",
    "import.saveAndOpen": "Сохранить и открыть",
    "import.back": "Назад",
    "import.howItWorks": "Как это работает",
    "import.howIt1": "Расскажите рецепт — ИИ создаст название, ингредиенты с количествами и пошаговые инструкции",
    "import.howIt2": "Или введите всё вручную в поля ниже",
    "import.howIt3": "Добавьте фото и ссылку на источник (необязательно)",
    "import.howIt4": "Рецепт хранится локально в вашем браузере",
    "import.replaceConfirm": "Заменить содержимое рецептом от ИИ?",
    "import.error": "Что-то пошло не так. Попробуйте ещё раз.",
    "import.recipePreview": "Предпросмотр рецепта",

    "grocery.title": "Ваш список покупок",
    "grocery.groceryList": "Список покупок",
    "grocery.items": "{total} товаров из {recipes} рецептов",
    "grocery.checked": "{checked} из {total} отмечено",
    "grocery.uncheckAll": "Снять все отметки",
    "grocery.backToPlan": "← Назад к плану",
    "grocery.noMeals": "Нет запланированных блюд",
    "grocery.goToPlan": "Перейти к плану",
    "grocery.produce": "Овощи и фрукты",
    "grocery.meatPoultry": "Мясо и птица",
    "grocery.seafood": "Морепродукты",
    "grocery.dairyEggs": "Молочные и яйца",
    "grocery.grainsPasta": "Крупы и макароны",
    "grocery.cannedJarred": "Консервы и соусы",
    "grocery.spicesSeasonings": "Специи и приправы",
    "grocery.other": "Другое",

    "notFound.title": "404 Страница не найдена",
    "notFound.message": "Вы забыли добавить страницу в маршрутизатор?",
  },

  he: {
    "nav.recipeView": "מתכון",
    "nav.weeklyMeals": "תפריט שבועי",
    "nav.importRecipe": "ייבוא מתכון",
    "nav.groceryList": "רשימת קניות",

    "recipe.backToSelection": "→ חזרה לבחירה",
    "recipe.addToMyPicks": "הוסף למועדפים",
    "recipe.removeFromMyPicks": "הסר מהמועדפים",
    "recipe.howDidThisTurnOut": "איך יצא?",
    "recipe.source": "מקור: אישי • שונה על ידך",
    "recipe.nutrition": "למנה (בערך): 320 קק״ל · ח 28ג · ש 12ג · פ 24ג",
    "recipe.servings": "מנות",
    "recipe.guidance": "הדרכה",
    "recipe.focus": "מיקוד",
    "recipe.notes": "הערות",
    "recipe.result": "תוצאה",
    "recipe.cup": "כוס",
    "recipe.stepOf": "שלב {current} מתוך {total}",
    "recipe.completed": "✓ הושלם",
    "recipe.done": "!סיום",
    "recipe.cookAgain": "בישול מחדש",
    "recipe.timer": "טיימר ({time})",
    "recipe.stop": "עצור",
    "recipe.startTimer": "התחל טיימר {min} דק׳",
    "recipe.showHint": "הצג רמז",
    "recipe.hint": ":רמז",
    "recipe.markDone": "← סמן כבוצע",
    "recipe.finishCooking": "✓ סיום בישול",
    "recipe.nextStep": "← שלב הבא",
    "recipe.ingredientsReady": "✓ מרכיבים מוכנים",
    "recipe.myNotes": "ההערות שלי",
    "recipe.myResult": "התוצאה שלי",
    "recipe.removePhoto": "הסר תמונה",
    "recipe.openRecipe": "פתח מתכון",
    "recipe.plov": "פלוב",

    "meals.tablewise": "Tablewise",
    "meals.weeklyPlan": "תוכנית שבועית",
    "meals.calmPlanning": "תכנון שבועי רגוע",
    "meals.howItWorks": "איך זה עובד",
    "meals.plan": "תוכנית",
    "meals.cost": "עלות",
    "meals.logIn": "התחבר",
    "meals.backToSelection": "→ חזרה לבחירה",
    "meals.clearWeek": "נקה שבוע",
    "meals.weekLocked": "השבוע נעול",
    "meals.unlock": "שחרר",
    "meals.finalizeWeek": "סיום שבוע",
    "meals.createGroceryList": "צור רשימת קניות",
    "meals.selectedRecipes": "מתכונים שנבחרו",
    "meals.weekIsLocked": "השבוע נעול",
    "meals.dragToCalendar": "גרור ללוח השנה",
    "meals.myPicks": "המועדפים שלי",
    "meals.allRecipes": "כל המתכונים",
    "meals.allOnPlan": "כל המתכונים שנבחרו בתוכנית.",
    "meals.selectedThisWeek": "נבחר השבוע",
    "meals.weeklyPlanTitle": "תוכנית שבועית",
    "meals.lockedUnlockToEdit": "נעול - שחרר לעריכה",
    "meals.weekFinalized": "השבוע הסתיים. שחרר לשינויים.",
    "meals.dragToSlots": "גרור ארוחות למקומות. השתמש ב +/− להרחבה.",
    "meals.dropHere": "שחרר כאן",
    "meals.locked": "נעול",
    "meals.days": "{count} ימים",
    "meals.step2Title": "שלב 2 — ארוחות",
    "meals.step2Desc": "בחר ארוחות ערב עם סינון. בחר 6–12 אפשרויות. נבנה שבוע מזה.",
    "meals.selected": "נבחרו: {count} / 12",
    "meals.max12": "מקסימום 12 בחירות.",
    "meals.noRecipesMatch": "אין מתכונים התואמים את הסינון.",
    "meals.add": "הוסף",
    "meals.added": "נוסף",
    "meals.generateWeeklyPlan": "צור תוכנית שבועית",
    "meals.select6": "בחר לפחות 6 מתכונים ליצירת תוכנית.",
    "meals.filters": "סינון ({count})",
    "meals.clearAll": "נקה הכל",
    "meals.maxMinutes": "מקס׳ דקות",
    "meals.dietary": "תזונה",
    "meals.vegetarian": "צמחוני",
    "meals.kidFriendly": "מתאים לילדים",
    "meals.glutenFree": "ללא גלוטן",
    "meals.mealType": "סוג ארוחה",
    "meals.breakfast": "ארוחת בוקר",
    "meals.lunch": "ארוחת צהריים",
    "meals.dinner": "ארוחת ערב",
    "meals.lunchBox": "קופסת אוכל",
    "meals.cookingMethod": "שיטת בישול",
    "meals.oven": "תנור",
    "meals.airFryer": "סיר אוויר",
    "meals.stovetop": "כיריים",
    "meals.noCook": "ללא בישול",
    "meals.source": "מקור",
    "meals.myRecipes": "המתכונים שלי",
    "meals.imported": "מיובאים",
    "meals.trustedAuthors": "מחברים מהימנים",
    "meals.personal": "אישי",
    "meals.lessFilters": "− פחות סינון",
    "meals.moreFilters": "+ עוד סינון",
    "meals.proteinType": "סוג חלבון",
    "meals.chicken": "עוף",
    "meals.beef": "בקר",
    "meals.seafood": "דגים ופירות ים",
    "meals.plantBased": "צמחי",
    "meals.myPicksFilter": "מועדפים ⭐",
    "meals.showOnlyMyPicks": "הצג רק מועדפים",
    "meals.minimumRating": "דירוג מינימלי",
    "meals.any": "הכל",
    "meals.withMyNotes": "עם ההערות שלי",
    "meals.modifiedByMe": "שונה על ידי",
    "meals.mustInclude": "חייב לכלול",
    "meals.mustExclude": "חייב לא לכלול",
    "meals.typeEnter": "הקלד + Enter",
    "meals.servingsFilter": "מנות",
    "meals.min": "{count} דק׳",

    "meals.sun": "א׳",
    "meals.mon": "ב׳",
    "meals.tue": "ג׳",
    "meals.wed": "ד׳",
    "meals.thu": "ה׳",
    "meals.fri": "ו׳",
    "meals.sat": "ש׳",

    "import.label": "ייבוא",
    "import.title": "הוסף את המתכון שלך",
    "import.subtitle": "הדבק כותרת, מרכיבים ושלבים. נשמר בדפדפן שלך.",
    "import.photo": "תמונה (אופציונלי)",
    "import.takePhoto": "צלם או העלה תמונה",
    "import.sourceLink": "קישור למקור (אופציונלי)",
    "import.sourcePlaceholder": "הדבק קישור (אינסטגרם, אתר, יוטיוב)",
    "import.invalidUrl": "הזן כתובת URL תקינה (לדוגמה, https://...)",
    "import.voiceAi": "(AI) קול",
    "import.speakRecipe": "ספר את המתכון",
    "import.voiceDesc": "אמור את המתכון בקול — AI יארגן אותו: כותרת, מרכיבים ושלבים.",
    "import.voiceNotSupported": "הקלטת קול אינה נתמכת בדפדפן זה.",
    "import.startDictation": "התחל הקלטה",
    "import.stopDictation": "עצור",
    "import.aiThinking": "…AI חושב",
    "import.generateWithAi": "צור מתכון עם AI",
    "import.tipDescribe": "טיפ: תאר את המתכון בטבעיות — AI יארגן אותו.",
    "import.listening": "…מאזין",
    "import.transcriptReady": "הטקסט מוכן — לחץ 'צור מתכון עם AI'.",
    "import.sendingToAi": "…שולח ל-AI",
    "import.clear": "נקה",
    "import.titleLabel": "כותרת",
    "import.titlePlaceholder": "לדוגמה, קערות קינואה עם ירקות",
    "import.titleHint": "כותרת תעזור למצוא את המתכון אחר כך",
    "import.ingredientsLabel": "מרכיבים (אחד בכל שורה)",
    "import.stepsLabel": "שלבים (אחד בכל שורה)",
    "import.saveAndOpen": "שמור ופתח",
    "import.back": "חזרה",
    "import.howItWorks": "איך זה עובד",
    "import.howIt1": "ספר את המתכון — AI ייצור כותרת, מרכיבים עם כמויות והוראות שלב אחר שלב",
    "import.howIt2": "או הקלד הכל ידנית בשדות למטה",
    "import.howIt3": "הוסף תמונה וקישור למקור (אופציונלי)",
    "import.howIt4": "המתכון נשמר בדפדפן שלך",
    "import.replaceConfirm": "להחליף תוכן קיים במתכון מ-AI?",
    "import.error": "משהו השתבש. נסה שוב.",
    "import.recipePreview": "תצוגה מקדימה",

    "grocery.title": "רשימת הקניות שלך",
    "grocery.groceryList": "רשימת קניות",
    "grocery.items": "{total} פריטים מ-{recipes} מתכונים",
    "grocery.checked": "{checked} מתוך {total} סומנו",
    "grocery.uncheckAll": "בטל סימון הכל",
    "grocery.backToPlan": "→ חזרה לתוכנית",
    "grocery.noMeals": "אין ארוחות מתוכננות",
    "grocery.goToPlan": "עבור לתוכנית",
    "grocery.produce": "ירקות ופירות",
    "grocery.meatPoultry": "בשר ועוף",
    "grocery.seafood": "דגים ופירות ים",
    "grocery.dairyEggs": "חלב וביצים",
    "grocery.grainsPasta": "דגנים ופסטה",
    "grocery.cannedJarred": "שימורים ורטבים",
    "grocery.spicesSeasonings": "תבלינים",
    "grocery.other": "אחר",

    "notFound.title": "404 הדף לא נמצא",
    "notFound.message": "שכחת להוסיף את הדף לנתב?",
  },
};

function detectSystemLanguage(): Language {
  if (typeof navigator === "undefined") return "en";
  const lang = navigator.language || (navigator as any).userLanguage || "en";
  const code = lang.split("-")[0].toLowerCase();
  if (code === "ru") return "ru";
  if (code === "he" || code === "iw") return "he";
  return "en";
}

function loadLanguage(): Language {
  try {
    const saved = localStorage.getItem("tablewise_language");
    if (saved && (saved === "en" || saved === "ru" || saved === "he")) {
      return saved as Language;
    }
  } catch {}
  return detectSystemLanguage();
}

interface I18nContextType {
  lang: Language;
  setLang: (lang: Language) => void;
  t: (key: string, params?: Record<string, string | number>) => string;
  dir: "ltr" | "rtl";
}

const I18nContext = createContext<I18nContextType>({
  lang: "en",
  setLang: () => {},
  t: (key) => key,
  dir: "ltr",
});

export function I18nProvider({ children }: { children: ReactNode }) {
  const [lang, setLangState] = useState<Language>(loadLanguage);

  const setLang = (newLang: Language) => {
    setLangState(newLang);
    try {
      localStorage.setItem("tablewise_language", newLang);
    } catch {}
  };

  const dir = LANGUAGES.find(l => l.code === lang)?.dir || "ltr";

  useEffect(() => {
    document.documentElement.setAttribute("dir", dir);
    document.documentElement.setAttribute("lang", lang);
  }, [lang, dir]);

  const t = (key: string, params?: Record<string, string | number>): string => {
    let text = translations[lang]?.[key] || translations.en[key] || key;
    if (params) {
      Object.entries(params).forEach(([k, v]) => {
        text = text.replace(`{${k}}`, String(v));
      });
    }
    return text;
  };

  return (
    <I18nContext.Provider value={{ lang, setLang, t, dir }}>
      {children}
    </I18nContext.Provider>
  );
}

export function useI18n() {
  return useContext(I18nContext);
}
